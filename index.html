<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <title>フクナガを救え！</title>
        <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/467.png">
        <script src="crafty-min.js"></script>
        <style type="text/css">
            body{
                padding:0px;
                margin:0px;
            }
        </style>
    </head>
    <body onLoad="timestart()">
        <style type="text/css">
            .margin {
                width: 1000px;
                margin:auto;             
                margin-top: 5%;
            }
            .message_box {
                background-color: #f0fff0;  /* 背景色指定 */
                margin:  50px;                /* 周りの余白指定 */                
                height: 230px;                /* 高さ指定 */
                width: 350px;                 /* 幅指定 */
                color: #2196F3;             /* 文字色指定 */
                text-align:center;
            }
            .context {
                text-align:left;
            }
            .button {
				border: 3px solid #00b900;
                background-color: #00b900;  /* 背景色指定 */
				color: #ffffff;
				border-radius: 100vh;
				font-size: 1.0em;
				width: 80px;
				cursor: pointer;
            }
            .float_test {
                float: left;                /* 回り込み指定 */
            }
        </style>
        <div class="margin">
            <div id="game" class="float_test"></div>
            <div class="float_test message_box">
                <h3>フクナガを救え!</h3>
                <p class="context">
                　　・フクナガを30匹救ったらクリア！<br>
                　　・金フクナガは通常フクナガ3匹分！<br>
                　　・酒に3回当たったらゲームオーバー！<br>
                　　・こつぶこましょで1回復！</p>
                <input class="button" type="button"  value="リセット" onclick="koshin()">
				<a href="https://twitter.com/share?ref_src=twsrc%5Etfw&amp;hashtags=こましょのゲーム&url=yurukei-career.com&text=フクナガを救え！" class="button" data-show-count="false" style="text-decoration: none;" >ツイート</a>
            </div>    
        </div>
        <script>
            Crafty.init(500,400, document.getElementById('game'));
            Crafty.background('#ffffC0');
            // キャラ
            Crafty.sprite(70,93,"ikoma2.png",{chara:[0,0]});
            Crafty.e('2D, Canvas, chara, Gravity, Twoway, SpriteAnimation')
                .attr({x:5, y:50})   // 左端は安全エリア
                .twoway(300)
                .jumper(0)      // ジャンプさせない
                .bind('EnterFrame', function () {
                    if( this.x < 0 ) this.x = 0;
                    if( this.x > 500 - this.w ) this.x = 500 - this.w;
                })
                .gravity('Floor');
            // 地面
            Crafty.e('Floor, 2D, Canvas, Color')
                .attr({x:0, y:350, w:500, h:10})
                .color('#a0522d');
            // 安置
            Crafty.e('Floor, 2D, Canvas, Color')
                .attr({x:0, y:350, w:75, h:10})
                .color('#0000ff');
            // 隕石の絵を用意
            Crafty.sprite(50,46,"sakazuki.png",{meteor:[0,0]});
            // 隕石の発生
            Crafty.bind("EnterFrame", function(){
                if (Crafty.frame() % 50 == 0) obj_drop();
            });
            // 変数
            let damage = 0; 
            // 隕石を落とす
            function obj_drop(){
                Crafty.e("meteor, 2D, Canvas, Gravity, Collision")
                    .attr({x:Crafty.math.randomInt(80, 500-55), y:-50})
                    .checkHits("chara")
                    .bind("HitOn", function (hitData) {
                        //Crafty.pause();     // すべてを止める
                        damage += 10;
                        // Crafty("Damage").text("DAMAGE: "+damage);   // ダメージ表示更新
                        if( damage == 10 ){
                            Crafty("Damage").text("♥♥");  
                        }
                        if( damage == 20 ){
                            Crafty("Damage").text("♥");  
                        }
                        // if( damage >= 60 ){
                        //     Crafty("Damage").textColor('#dc143c');  // 文字の色を変更
                        // }
                        if( damage >= 30 ){
                            Crafty("Damage").text("♡");  
                            Crafty.pause();
                            Crafty.e('2D, DOM, Text')
                                .attr({x:130, y:150, w:300})
                                .text("GAME OVER").textColor('#00ff7f')
                                .textFont({size:'40px', weight:'bold'});
                        }
                    })
                    .bind('EnterFrame', function () {
                        this.y += 10;
                        if( this.y > 500 ){
                            this.destroy();
                        }
                    });
            }
            // ごましょを落とす
            Crafty.sprite(50,50,"gomasyo1.png",{gomasyo:[0,0]});
            Crafty.bind("EnterFrame", function(){
                if (Crafty.frame() % 300 == 0) obj_heal();
            });
            function obj_heal(){
                Crafty.e("gomasyo, 2D, Canvas, Gravity, Collision")
                    .attr({x:Crafty.math.randomInt(80, 500-55), y:-50})
                    .checkHits("chara")
                    .bind("HitOn", function (hitData) {
                        //Crafty.pause();     // すべてを止める
                        if( damage >= 10 ){
                            damage = damage - 10;
                        }
                        if( damage == 0 ){
                            Crafty("Damage").text("♥♥♥");  
                        }
                        if( damage == 10 ){
                            Crafty("Damage").text("♥♥");  
                        }
                        if( damage == 20 ){
                            Crafty("Damage").text("♥");  
                        }
						this.destroy();
                    })
                    .bind('EnterFrame', function () {
                        this.y += 10;
                        if( this.y > 500 ){
                            this.destroy();
                        }
                    });
            }
            // ダメージの表示
            Crafty.e("Damage, DOM, 2D, Text")
                .attr({ x:20, y:20, w:180, h:20 })
                .textFont({size:'20px', weight:'bold'})
                .textColor('#dc143c')
                .text("♥♥♥");
            // スコアの表示
            let score = 0;
            Crafty.e("Score, DOM, 2D, Text")
                .attr({ x:20, y:50, w:180, h:20 })
                .textFont({size:'20px', weight:'bold'})
                .text("救ナガの数:0");
			// 時間の表示
			let time = 0;
			Crafty.e("time, DOM, 2D, Text")
                .attr({ x:20, y:80, w:180, h:20 })
                .textFont({size:'20px', weight:'bold'})
                .text(time+"秒");
			function timestart() {
			   time = setInterval('timecount()',1000);
			}
			function timecount() {
               Crafty("time").text(time+"秒");
			   time += 1;
			}
			window.onload = timestart();
            // キャンディ落とす
            Crafty.sprite(50,50,"fukunaga1.png",{Candy:[0,0]});
            Crafty.bind("EnterFrame", function(){
                if (Crafty.frame() % 120 == 0) dropCandy();
            });
            function dropCandy(){
                Crafty.e("Candy, 2D, Canvas, Gravity, Collision")
                    .attr({x:Crafty.math.randomInt(80, 500-55), y:-50})
                    .checkHits("chara")
                    .bind("HitOn", function (hitData) {
                        score += 1;
                        Crafty("Score").text("救ナガの数:"+score);
                        if( score >= 30 ){
                            Crafty.pause();
                            Crafty.e('2D, DOM, Text')
                                .attr({x:120, y:150, w:300})
                                .text("GAME CLEAR").textColor('#00ff7f')
                                .textFont({size:'40px', weight:'bold'});
                        }
                        this.destroy();
                    })
                    .bind('EnterFrame', function () {
                        this.y += 5;
                        if( this.y > 500 ){
                            this.destroy();
                        }
                    });
            }
            // 金フクナガを落とす
            Crafty.sprite(50,50,"golnaga1.png",{Gold:[0,0]});
            Crafty.bind("EnterFrame", function(){
                if (Crafty.frame() % 300 == 0) dropGold();
            });
            function dropGold(){
                Crafty.e("Gold, 2D, Canvas, Gravity, Collision")
                    .attr({x:Crafty.math.randomInt(80, 500-55), y:-50})
                    .checkHits("chara")
                    .bind("HitOn", function (hitData) {
                        score += 3;
                        Crafty("Score").text("救ナガの数:"+score);
                        if( score >= 30 ){
                            Crafty.pause();
                            Crafty.e('2D, DOM, Text')
                                .attr({x:120, y:150, w:300})
                                .text("GAME CLEAR").textColor('#00ff7f')
                                .textFont({size:'40px', weight:'bold'});
                        }
                        this.destroy();
                    })
                    .bind('EnterFrame', function () {
                        this.y += 5;
                        if( this.y > 500 ){
                            this.destroy();
                        }
                    });
            }
        function koshin(){
            location.reload();
        }    
        </script>
    </body>
</html>